# 📡 后端POST接口使用说明

## 同事需求分析

根据您同事的描述，需求如下：

1. **"前边那几行是请求头"** - 后端会发送HTTP请求，包含请求头信息
2. **"你这边要运行着一个端口,然后我往你的端口 post 发这个请求体"** - 前端需要运行一个HTTP服务器，监听端口，接收POST请求
3. **"然后你这边接收到之后,直接自动填就行,自动输出一个链接"** - 接收到数据后，自动填充到应用中，并生成分享链接

## 🚀 解决方案

我已经创建了一个Express服务器 (`server.js`)，可以接收后端的POST请求。

### 启动服务器

```bash
# 安装依赖（如果还没安装）
npm install

# 启动服务器（默认端口3001）
npm run server

# 或者同时启动前端和服务器
npm run dev:all
```

### 服务器信息

- **端口**: 3001（可在环境变量中设置 `PORT=3001`）
- **POST接口**: `http://localhost:3001/api/receive-data`
- **健康检查**: `http://localhost:3001/health`
- **最近数据**: `http://localhost:3001/api/recent-data`（用于调试）

## 📥 接口说明

### POST /api/receive-data

接收后端发送的学生数据，自动生成分享链接。

**请求示例：**

```bash
curl -X POST http://localhost:3001/api/receive-data \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer token" \
  -d '{
    "student_name": "张小明",
    "current_level": 3,
    "days_since_first_large_order": 365,
    "current_class_hours": 120,
    ...
  }'
```

**响应示例：**

```json
{
  "success": true,
  "shareLink": "http://localhost:3000?data=eyJzdHVkZW50X25hbWUiOiL...",
  "message": "数据接收成功，分享链接已生成",
  "timestamp": "2024-01-01T12:00:00.000Z"
}
```

## 🔄 工作流程

1. **启动服务器**
   ```bash
   npm run server
   ```

2. **后端发送POST请求**
   - 后端向 `http://localhost:3001/api/receive-data` 发送POST请求
   - 请求体包含JSON格式的学生数据
   - 可以包含请求头（如Authorization等）

3. **服务器处理**
   - 服务器接收并验证数据
   - 自动生成分享链接
   - 返回链接给后端

4. **后端返回链接**
   - 后端将链接发送给用户
   - 用户点击链接即可查看数据

## 📋 请求格式

### 支持两种字段名格式

1. **英文字段名**（推荐）：
```json
{
  "student_name": "张小明",
  "current_level": 3,
  ...
}
```

2. **中文字段名**：
```json
{
  "学生姓名": "张小明",
  "当前级别": 3,
  ...
}
```

## ⚙️ 配置

### 修改端口

```bash
# Windows PowerShell
$env:PORT=3002; node server.js

# Linux/Mac
PORT=3002 node server.js
```

### 修改前端URL

```bash
# Windows PowerShell
$env:FRONTEND_URL="https://your-domain.com"; node server.js

# Linux/Mac
FRONTEND_URL="https://your-domain.com" node server.js
```

## 🔍 调试

### 查看最近接收的数据

访问：`http://localhost:3001/api/recent-data`

### 健康检查

访问：`http://localhost:3001/health`

### 查看服务器日志

服务器会在控制台输出：
- 接收到的请求头
- 接收到的请求体
- 生成的分享链接
- 错误信息（如果有）

## 📝 注意事项

1. **端口冲突**：确保3001端口没有被占用，如果被占用可以修改PORT环境变量
2. **跨域问题**：服务器已配置CORS，允许跨域请求
3. **数据验证**：服务器会验证必需字段（student_name或学生姓名）
4. **链接生成**：生成的链接指向前端应用（默认localhost:3000）

## 🐛 常见问题

### Q: 端口被占用怎么办？
A: 修改PORT环境变量或修改server.js中的默认端口

### Q: 如何查看接收到的数据？
A: 访问 `http://localhost:3001/api/recent-data` 查看最近10条数据

### Q: 生成的链接打不开？
A: 确保前端应用正在运行（npm run dev），并检查FRONTEND_URL配置

### Q: 后端发送请求后没有响应？
A: 检查服务器日志，查看是否有错误信息

## 📞 测试

使用curl测试：

```bash
curl -X POST http://localhost:3001/api/receive-data \
  -H "Content-Type: application/json" \
  -d '{
    "student_name": "测试学生",
    "current_level": 1
  }'
```

预期响应：
```json
{
  "success": true,
  "shareLink": "http://localhost:3000?data=...",
  "message": "数据接收成功，分享链接已生成",
  "timestamp": "..."
}
```

